#
# Makefile for testing tools
# Copyright 2008 Mike McCormack
#

DEPFLAG = -Wp,-MD,.$@.d
CC=@MINGW32CC@
STRIP=@MINGW32STRIP@
CFLAGS=-Wall -O2 $(DEPFLAG)
AS=@MINGW32AS@
AR=@MINGW32AR@
RANLIB=@MINGW32RANLIB@
WINDRES=@MINGW32WINDRES@

SOURCE = \
	console.c \
	dumphandles.c \
	hello.c \
	minitris.c \
	pixels.c \
	qdf.c \
	startcmd.c

.PHONY: all clean

NTWIN32LIB=../tests/win2k/ntwin32.dll

all: $(SOURCE:.c=.exe) advapi32.dll

include $(wildcard .*.d)

advapi32.dll: advapi32.c
	$(CC) -o $@ -shared $< -e _DllMain@12 -Wl,--kill-at

dumphandles.exe: dumphandles.c $(NTWIN32LIB)
	$(CC) $(CFLAGS) -o $@ $< $(NTWIN32LIB) -lntdll -lkernel32 -luser32

hello.exe: hello.c
	$(CC) $(CFLAGS) -o $@ $< -lntdll -lkernel32 -mconsole

qdf.exe: qdf.c
	$(CC) $(CFLAGS) -o $@ $< -luser32 -lkernel32 -lntdll -lgdi32

startcmd.exe: startcmd.c
	$(CC) $(CFLAGS) -o $@ $< -lntdll -lkernel32 -lgdi32 -Wl,--subsystem=windows

console.exe: console.c
	$(CC) $(CFLAGS) -o $@ $< -lntdll -lkernel32 -lgdi32 -Wl,--subsystem=windows

pixels.exe: pixels.c
	$(CC) $(CFLAGS) -o $@ $< -lntdll -lkernel32 -lgdi32 -Wl,--subsystem=windows

minitris.exe: minitris.c
	$(CC) $(CFLAGS) -o $@ $< -lgdi32 -luser32 -Wl,--subsystem=windows

clean:
	rm -f *.o advapi32.dll dumphandles.exe hello.exe qdf.exe winlogon.exe .*.d
